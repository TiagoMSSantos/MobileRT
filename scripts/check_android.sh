#!/bin/bash

###############################################################################
# Exit immediately if a command exits with a non-zero status
###############################################################################
set -e
###############################################################################
###############################################################################

###############################################################################
# Change directory to MobileRT root
###############################################################################
cd "$(dirname "${BASH_SOURCE[0]}")/.." || exit
###############################################################################
###############################################################################

###############################################################################
# Get arguments
###############################################################################
ndk_version="${1:-21.3.6528147}"
cmake_version="${2:-3.10.2}"
###############################################################################
###############################################################################

###############################################################################
# Get helper functions
###############################################################################
source scripts/helper_functions.sh
###############################################################################
###############################################################################

###############################################################################
# Run Gradle linter
###############################################################################

function runLinter() {
  # Set path to reports
  reports_path=./app/build/reports
  profile_path=./reports/profile
  callCommand mkdir -p ${reports_path}
  callCommand mkdir -p ${profile_path}

  echo "Print Gradle version"
  callCommand ./gradlew --version

  echo "Calling the Gradle linter"
  callCommand ./gradlew check --profile --parallel \
    -DndkVersion="${ndk_version}" -DcmakeVersion="${cmake_version}" \
    --console plain \
    2>&1 | tee ${reports_path}/log_check.log
  resCheck=${PIPESTATUS[0]}
}

###############################################################################
###############################################################################

runLinter

###############################################################################
# Exit code
###############################################################################
printCommandExitCode "${resCheck}" "Check"
###############################################################################
###############################################################################
